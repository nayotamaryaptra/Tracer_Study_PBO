{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-lg rounded-4">
            <div class="card-header bg-white border-0 py-3">
                <h4 class="fw-bold text-primary mb-0">
                    <i class="bi bi-person-lines-fill me-2"></i> {{ form.instance.pk|yesno:"Edit Data Alumni,Tambah Alumni Baru" }}
                </h4>
            </div>
            <div class="card-body p-4">
                <form method="post" id="alumniForm" data-prodi-url="{% url 'alumni:ajax_load_prodi' %}">
                    {% csrf_token %}
                    
                    <div class="alert alert-light border border-primary-subtle text-primary small mb-4">
                        <i class="bi bi-info-circle-fill me-1"></i> 
                        Silakan pilih <strong>Fakultas</strong> terlebih dahulu, daftar <strong>Program Studi</strong> akan menyesuaikan otomatis.
                    </div>

                    {{ form|crispy }}
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4 pt-3 border-top">
                        <a href="{% url 'alumni:list' %}" class="btn btn-light px-4 text-muted fw-medium">
                            Batal
                        </a>
                        <button type="submit" class="btn btn-primary px-4 shadow-sm">
                            <i class="bi bi-save me-1"></i> Simpan Data
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Ambil elemen dropdown
        const fakultasSelect = $('#id_fakultas');
        const prodiSelect = $('#id_prodi');
        const url = $("#alumniForm").attr("data-prodi-url");

        // Fungsi saat Fakultas berubah
        fakultasSelect.change(function () {
            const fakultasId = $(this).val();

            if (fakultasId) {
                // Tampilkan text loading
                prodiSelect.html('<option value="">Sedang memuat...</option>');

                // Request ke Server (Django View)
                $.ajax({
                    url: url,
                    data: {
                        'fakultas_id': fakultasId
                    },
                    success: function (data) {
                        let html = '<option value="">---------</option>';
                        data.forEach(function (item) {
                            html += `<option value="${item.id}">${item.nama}</option>`;
                        });
                        prodiSelect.html(html);
                    }
                });
            } else {
                prodiSelect.html('<option value="">---------</option>');
            }
        });
    });
</script>
{% endblock %}