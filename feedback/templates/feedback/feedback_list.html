{% extends 'base.html' %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold text-success">
            <i class="bi bi-chat-square-quote-fill"></i> Feedback Kurikulum
        </h2>
        <p class="text-muted mb-0">
            {% if is_admin %}
                Evaluasi dan masukan alumni terhadap mata kuliah.
            {% else %}
                Suara Anda sangat berarti untuk perbaikan kurikulum kami.
            {% endif %}
        </p>
    </div>
    
    {% if not is_admin %}
        <a href="{% url 'feedback:create' %}" class="btn btn-success shadow-sm px-4 rounded-pill">
            <i class="bi bi-pencil-fill me-1"></i> Beri Masukan Baru
        </a>
    {% endif %}
</div>

{% if is_admin %}
<div class="card border-0 shadow-sm mb-4 bg-white">
    <div class="card-body py-3">
        <form method="get" class="row g-2 align-items-center">
            <div class="col-auto text-muted fw-bold small">
                <i class="bi bi-search"></i> FILTER:
            </div>
            
            <div class="col-md-3">
                <div class="input-group input-group-sm">
                    <span class="input-group-text bg-light border-0"><i class="bi bi-book"></i></span>
                    <input type="text" name="matkul" class="form-control form-control-sm border-0 bg-light" placeholder="Cari Mata Kuliah..." value="{{ request.GET.matkul|default:'' }}">
                </div>
            </div>

            <div class="col-md-3">
                <select name="prodi" class="form-select form-select-sm border-0 bg-light fw-medium">
                    <option value="">-- Semua Prodi --</option>
                    {% for p in prodi_list %}
                        <option value="{{ p.id }}" {% if request.GET.prodi == p.id|stringformat:"i" %}selected{% endif %}>
                            {{ p.nama }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2">
                <select name="tahun" class="form-select form-select-sm border-0 bg-light fw-medium">
                    <option value="">-- Tahun Lulus --</option>
                    {% for t in tahun_list %}
                        <option value="{{ t }}" {% if request.GET.tahun == t|stringformat:"i" %}selected{% endif %}>
                            {{ t }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-auto">
                <button type="submit" class="btn btn-sm btn-success px-3 rounded-pill shadow-sm">
                    Cari Data
                </button>
                <a href="{% url 'feedback:list' %}" class="btn btn-sm btn-link text-decoration-none text-muted">Reset</a>
            </div>
        </form>
    </div>
</div>
{% endif %}

<div class="card border-0 shadow rounded-4 overflow-hidden">
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="bg-light text-uppercase small text-muted">
                <tr>
                    {% if is_admin %}<th class="py-3 ps-4">Pengirim</th>{% endif %}
                    <th class="py-3 {% if not is_admin %}ps-4{% endif %}">Mata Kuliah</th>
                    <th class="py-3 text-center">Penilaian</th>
                    <th class="py-3" width="35%">Saran & Masukan</th>
                    <th class="py-3 text-end pe-4">Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for f in feedbacks %}
                <tr>
                    {% if is_admin %}
                    <td class="ps-4">
                        <div class="fw-bold text-dark">{{ f.alumni.nama }}</div>
                        <small class="text-muted">{{ f.alumni.prodi.nama }}</small>
                    </td>
                    {% endif %}

                    <td class="{% if not is_admin %}ps-4{% endif %} fw-medium text-dark">
                        {{ f.mata_kuliah }}
                    </td>

                    <td class="text-center">
                        {% if f.kesesuaian == 'Sangat Sesuai' or f.kesesuaian == 'Sangat Baik' %}
                            <span class="badge bg-success bg-opacity-10 text-success border border-success rounded-pill px-3">Sangat Sesuai</span>
                        {% elif f.kesesuaian == 'Sesuai' or f.kesesuaian == 'Baik' %}
                            <span class="badge bg-primary bg-opacity-10 text-primary border border-primary rounded-pill px-3">Sesuai</span>
                        {% elif f.kesesuaian == 'Kurang' or f.kesesuaian == 'Cukup' %}
                            <span class="badge bg-warning bg-opacity-10 text-warning border border-warning rounded-pill px-3">Kurang</span>
                        {% else %}
                            <span class="badge bg-danger bg-opacity-10 text-danger border border-danger rounded-pill px-3">Tidak Sesuai</span>
                        {% endif %}
                    </td>

                    <td class="text-muted fst-italic small">
                        "{{ f.saran|truncatewords:15 }}"
                    </td>

                    <td class="text-end pe-4">
                        {% if not is_admin %}
                            <a href="{% url 'feedback:edit' f.pk %}" class="btn btn-sm btn-outline-warning border-0" title="Edit">
                                <i class="bi bi-pencil-square fs-6"></i>
                            </a>
                        {% endif %}
                        <a href="{% url 'feedback:delete' f.pk %}" class="btn btn-sm btn-outline-danger border-0" title="Hapus">
                            <i class="bi bi-trash fs-6"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="{% if is_admin %}5{% else %}4{% endif %}" class="text-center py-5">
                        <div class="text-muted opacity-25 mb-2">
                            <i class="bi bi-chat-square-text" style="font-size: 3rem;"></i>
                        </div>
                        <p class="text-muted mb-0">Belum ada data feedback.</p>
                        {% if not is_admin %}
                            <a href="{% url 'feedback:create' %}" class="btn btn-sm btn-success mt-2 rounded-pill">
                                Tulis Masukan
                            </a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}